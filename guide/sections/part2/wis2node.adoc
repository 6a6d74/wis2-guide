=== Implementation and operation of a WIS2 Node

==== Practices and procedures

===== Registration and decommissioning of a WIS2 Node

Registration and decomissioning of WIS2 Nodes must be approved by the PR for the centre registering or decomissioning a WIS2 Node.

WMO Secretariat will operate a WIS2 register. The registration of a WIS2 Node involves the following steps:

* Request hosting a WIS2 Node: A request for hosting a WIS2 Node shall be put forward by the Permanent Representative of the country of the WIS2 Node host centre, or, in the case of international organizations, by either the Permanent Representative (PR) of the country where the WIS2 Node host centre is located or the president of the relevant organization in case of WMO partner or programme designated as DCPC.
* Assign a centre-id: The centre identifier (`centre-id`) is an acronym as specified by the member and endorsed by the PR of the country and WMO. It is a single identifier comprised of a top level domain (TLD) and centre name, and represents the data publisher, distributor or issuing centre of a given dataset or data product/granule (see the Topic Hierarchy Manual on WIS Vol II).
* Complete the WIS2 Register: The WIS National Focal Point shall complete the WIS2 Register operated by the WMO Secretariat
* WIS2 Node assessment: the principal GISC verifies that the WIS2 Node is compliant with WIS2 requirements. The assessment includes:
  - the verification of the compliance of the WIS2 Topic Hierarchy (WTH) used by the centre with the WIS2 Topic Hierarchy.
  - verification of compliance of the Notification Message with the specifications.
  - verification that the download link is using HTTPS which is a preference for WIS2.

Upon completion of this verification, and confirmation that it satisfies all conditions for operating a WIS2 Node, GISC notifies WMO and confirms that this centre identifier can be added to WIS2.

* Communicate details to the Global services: WMO Secretariat provides the WIS2 Node details to the Global Brokers to subscribe to the WIS2 Node.

A diagram of the process of registering a WIS2 Node is presented below.

image::images/add-wis2node.png[Adding a WIS2 Node,link=images/add-wis2node.png]

===== Registration and removal of a dataset

Procedure for PR Approved WIS2 Node Registration is to create a centre identifier based on naming convention `ab-domain-nodename`.  Where `ab` is the the IANA Top Level Domain (TLD) code, domain is the organization's domain name for the main website, and nodename (optional) is descriptive of the purpose of the WIS2 Node (for example a node for a type of data or programme of the data e.g. climate, aviation, etc.) when the organization is hosting multiple WIS2 Nodes. A sample centre identifier is `ab-myorg-climate`.  In addition to the centre identifier the registering organization should also provide the broker endpoints.  Once centre identifier and broker endpoints are provided and entered into the WIS2 Node register, the WMO Secretariat will contact the GISC for the organization's country and request the GISC to verify the correctness of the provided information.  The GISC will request the centre produce a test message with associated files for download.  The GISC should use a test MQTT client to verify the notification message is correct and the download links are functional.  The GISC notifies the Centre of the results of the checks and if all are good, requests the Centre to provide metadata when the dataset is ready.  When metadata is proivided the GISC informs the WMO Secretariat that the new centre identifier is ready and requests it be added to WIS2.

In the case of NCs, the procedure for PR approved decomissioning of a WIS2 Node is the PR (or designate) will notify the WMO Secretariat of the decomissioning of the WIS2 Node. In the case of DCPCs, the sponsor (i.e., Regional Association or WMO Programme) is the Programme Chair or Regional Information Management Chair shall approve the decommissioning and notify the WMO Secretariat of the decomissioning of the WIS2 Node. Where possible, a 30 day notice period should be provided prior to the decomissioning and information on if the data from the Node will also be decomissioned or if it is available via another WIS2 Node or method.  The WMO Secretariat will notify the GISC for the country and the Global Service Providers of the date of the WIS2 Node decomissioning.

NC/DCPCs operators decomissioning a WIS2 Node shall ensure that obligations relating to data sharing within WIS continue to be met after the WIS2 Node is decommissioned, for example, by migrating these data sharing obligations to another WIS2 Node. In the case of DCPCs, this may mean the WIS2 Node responsibilities shift from one member to another and in the case these details should be included in the decomissioning notice to the WMO Serectariat.

A Data Producer publishes data via a WIS2 Node in accordance with the WIS2 Topic Hierarchy by creating a discovery metadata record, making it available for download, and publishing a notification of its availability (see how to publish data notifications TODO CROSSREF).  Global Brokers then subscribe to the relevant topic, receive the notification message, and then validate, ingest, and publish the associated dataset record.

All data shared in WIS2 must include metadata compliant with the metadata requriements described below.  Data providers must be approved by their PR (or designate such as the member's WIS Focal Point) to ensure quality metadata will be provied along with the data.

An organization ready to publish a new dataset should contact the WMO Secretariat with the approval of their PR (or designate) to The WMO Secretariat.  The WMO Secretariat will contact the GISC for the organizaiton with the new (meta)data.  The GISC will work with a Global Discovery Catalogue to verify the metadata.  the GDC will publish a report indicating errors and/or potential improvements (based on discovery metadata KPIs). The GISC should work with the data publisher to remedy issues and incporate suggestions for improvement.

In addition, the data publisher's affiliated GISC conduct a systematic review of what's being published to make sure everything is functional.

===== Connecting with Global Services

Once a WIS2 Node has been verified by a GISC and endpoints and metadata are available, the WMO Secretariat provides the new centre identifier to the Global Brokers and requests they subscribe to the new broker endpoint.  The Global Broker will recieve the data based on their topic subscriptions.  The Global Caches download and cache the metadata (and data where applicable for core datasets).

Once a GISC, in partnership with a Global Data Catalogue, verifies the metadata for a new dataset, the WMO Secretariat will be notified of the availability of the new dataset.  The WMO Seretariat will then notify the Global Borkers and Global Caches of the addition of new data to the WIS system.


==== Publishing data, discovery metadata, and notification messages


===== Discovery metadata


TODO: REMOVE SECTION

===== Notification messages


TODO: REMOVE SECTION

===== Data

TODO: REMOVE SECTION

==== Performance management

===== Service levels and performance indicators

A WIS2 Node must be able to:

- Publish datasets and compliant metadata and discovery metadata
  * Publish metadata to the Global Data Catalogue
  * Publish core data to the Global Cache
  * Publish data for consumer access
  * Publish data embedded in a message (i.e., CAP warnings)
  * Receive metadata publication errors from the Global Data Catalogue
  * Provide metadata with topics to Global Brokers

===== Provision of system performance metrics

WIS2 Nodes should provide annual performance metrics to their GISC.

If contacted by the Global Montior via GISC for a performance issue, the WIS2 Node should provide metrics to the GISC and Global Monitor when service is restored to indicate resolution of the issue.

==== WIS2 Node reference implementation: wis2box

To provide a WIS2 Node, members may use whichever software components they consider most appropriate to comply with WIS2 Technical Regulations.

To assist Members participate in WIS2, a free and open-source Reference Implementation is available for use.  WIS2 in a box (wis2box) implements the requirements of a WIS2 Node in as well as additional enhancements. wis2box builds on mature and robust free and open-source software components that are widely adopted for operational use.

wis2box provides functionality required for both data publisher and data consumer roles. It provides the following technical functions:

* Configuration, generation and publication of data (real-time or archive) and metadata to WIS2, compliant to WIS2 Node requirements
* MQTT Message Broker and notification message publication (Subscribe)
* HTTP object storage and raw data access (Download)
* Station metadata curation / editing tools (user interface)
* Discovery metadata curation / editing tools (user interface)
* Data entry tools (user interfaces)
* OGC API server, providing dynamic APIs for discovery, access, visualization and processing functionality (APIs)
* Extensible data "pipelines", allowing for transformation, processing and publishing of additional data types
* Provision of system performance and data availability metrics
* Access control for recommended data publication, as required
* Subscription to notifications and and download of WIS data from Global Services
* Modular design, allowing for extending to meet additional requirements or integrate with existing data management systems

Project documentation can be found at https://docs.wis2box.wis.wmo.int

wis2box is managed as a free and open source project.  Source code, issue tracking and discussions are hosted in the open on GitHub: https://docs.wis2box.wis.wmo.int.
